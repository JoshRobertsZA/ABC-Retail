@model List<CLDV6212POE.ViewModel.OrderViewModel>

@{
    ViewData["Title"] = "Orders";
    var userRole = Context.Session.GetString("UserRole");
    var userId = Context.Session.GetString("UserId");
}

@if (userRole == "Admin")
{
    <!-- Admin view (all orders) -->
    <div class="order">
        <div class="order-container">
            <div class="container py-5">

                <h2 class="order-amount-title">All Orders (@Model.Count)</h2>

                <table class="table-container table table-hover align-middle">
                    <thead style="background-color:#70aa93; color:white;">
                    <tr>
                        <th>Customer</th>
                        <th>Customer ID</th>
                        <th>Product</th>
                        <th>Order Date</th>
                        <th>Order Status</th>

                    </tr>
                    </thead>
                    <tbody>
                    @if (Model != null && Model.Any())
                    {
                        @foreach (var order in Model)
                        {
                            <tr data-bs-toggle="modal" data-bs-target="#orderModal-@order.RowKey" style="cursor:pointer;">
                                <td>@order.CustomerName</td>
                                <td>@order.CustomerId</td>
                                <td>@order.ProductName</td>
                                <td>@order.OrderDate</td>
                                <td>
                                    @{
                                        string statusClass = order.QueueStatus switch
                                        {
                                                "Completed" => "completed",
                                                "Processing" => "processed",
                                                _ => "pending"
                                        };
                                    }
                                        <span class="status-badge @statusClass">@order.QueueStatus</span>
                                </td>
                            </tr>

                            <!-- Render modal from partial -->
                            @await Html.PartialAsync("_OrderDetailsModal", order)
                        }
                    }
                    else
                    {
                        <tr>
                            <td colspan="6" class="text-center text-muted py-4">
                                No Orders Created.
                            </td>
                        </tr>
                    }
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <footer class="footer-container">

        <p class="footer-main">&copy; 2025 ABC Retail</p>
        <p class="footer-sub">Built by <span>Josh Roberts</span></p>
    </footer>
}
else if (!string.IsNullOrEmpty(userId))
{
    <!-- Customer view: only show their own orders -->
    <div class="order-container">
        @if (Model.Any(o => o.CustomerId == userId))
        {
            <div class="order-container">
                <div class="container py-5">
                    <h2 class="order-amount-title">Order Details (@Model.Count)</h2>

                    <table class="table-container table table-hover align-middle">
                        <thead style="background-color:#70aa93; color:white;">
                        <tr>
                            <th>Product Name</th>
                            <th>Product ID</th>
                            <th>Order Date</th>
                            <th>Status</th>
                        </tr>
                        </thead>
                        <tbody>
                        @foreach (var item in Model)
                        {
                            <tr data-bs-toggle="modal" data-bs-target="#orderModal-@item.RowKey" style="cursor:pointer;">

                                <td>
                                    <div class="d-flex align-items-center">
                                        <div>
                                            <strong>@item.ProductName</strong><br/>
                                            <small class="text-muted">Qty: @item.Quantity</small>
                                        </div>
                                    </div>
                                </td>
                                <td>@item.ProductID</td>
                                <td>@item.OrderDate</td>
                                <td>
                                        @{
                                            string statusClass = item.QueueStatus switch
                                            {
                                                "Completed" => "completed",
                                                "Processing" => "processed",
                                                _ => "pending"
                                            };
                                        }
                                        <span class="status-badge @statusClass">@item.QueueStatus</span>
                                </td>
                            </tr>

                            @await Html.PartialAsync("_OrderDetailsModal", item)
                        }
                        </tbody>
                    </table>
                </div>
            </div>

            <footer class="footer-container">
                <p class="footer-main">&copy; 2025 ABC Retail</p>
                <p class="footer-sub">Built by <span>Josh Roberts</span></p>
            </footer>
        }
        else
        {
            @* No Orders have been placed from Customer *@
            <div class="confirmation-container">
                <div class="confirm-order-container">
                    <img src="https://st10265742cldv6212.blob.core.windows.net/background/orderlogo.png" alt="Order Success"/>
                    <h3 class="confirm-header">No Orders Placed</h3>
                    <p class="confirm-subheader">You have no orders placed</p>

                    <div class="button-group">
                        <a asp-controller="Product" asp-action="Index" class="order-btn">Start Shopping</a>
                    </div>
                </div>
            </div>

            <footer class="footer-container">
                <p class="footer-main">&copy; 2025 ABC Retail</p>
                <p class="footer-sub">Built by <span>Josh Roberts</span></p>
            </footer>
        }
    </div>
}
else
{
    @* Not logged in *@
    <div class="confirmation-container">
        <div class="confirm-order-container">
            <img src="https://st10265742cldv6212.blob.core.windows.net/background/orderlogo.png" alt="Order Success"/>
            <h3 class="confirm-header">Login to view Orders</h3>
            <p class="confirm-subheader">You must be logged in to view order</p>

            <div class="button-group">
                <a asp-controller="Home" asp-action="Index" class="order-btn">Go Home</a>
            </div>
        </div>
    </div>

    <footer class="footer-container">
        <p class="footer-main">&copy; 2025 ABC Retail</p>
        <p class="footer-sub">Built by <span>Josh Roberts</span></p>
    </footer>
}